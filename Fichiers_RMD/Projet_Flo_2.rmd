---
title: "**Facteurs influençants la prise des transports en commun**"
author: "RACHIDI Mustapha & \n SAUNIER Florent & \n SAADALLAH Malek"
date : "**Janvier 2023**"
output : pdf_document

---

\newpage 

**Introduction**

  Ce projet se base sur des données récoltées en 2010 dans la région Grenobloise. L'étude a pour but de déterminer les facteurs influençants la prise des transports en commun . Pour cela nous nous sommes pris comme limites : le réseau Mtag qui comprend les bus qualifiés de "ville" (Nous n'avons pas pris en compte les bus régionaux comme par exemple le bus Grenoble - Chamrousse) et le réseau du trammway dont les lignes depuis 2010 ont été augmentées.\newline



**Articles de la littérature**


**Familiarisation avec la base de données**

```{r, include =FALSE}
pacman::p_load(naniar)
library(dplyr)
load("allgre.PB_V2.RData")
DB_projet_full<-allgre.PB_V2

dim(DB_projet_full) #nombre de lignes et de colonnes de la base de données 
#pacmann::
glimpse(DB_projet_full)  #a
sum(is.na(DB_projet_full)) 

pct_complete(DB_projet_full) #
pct_miss(DB_projet_full) 

pct_complete_var(DB_projet_full) #% de colonnes complètes ~21% 
pct_complete_case(DB_projet_full) # % de lignes complètes 0%


#summary(DB_projet_full) Le summary n'a pas de sens avec autant de colonnes 
```
La base de données contient 30 702 lignes et 116 colonnes ce qui correspond à nos variables , on peut la qualifier de base de données "moyenne" mais qui saura nous occuper. 
Concernant le nombre de valeurs manquantes, toutes variables confondues nous avons 971 658 valeurs manquantes soit 27.3% de notre base de données. 
De plus, 0% des lignes ont toutes leurs valeurs et c'est 21% des colonnes qui n'ont pas de valeurs manquantes. 
Il peut être intéressant de voir où sont les valeurs manquantes.\newline
L'échantillon comporte 5189 personnes 
```{r}


```

```{r, include=FALSE}
library(ggplot2)
library(naniar)
dim(DB_projet_full)[1]
sapply(DB_projet_full,function(x) (sum(is.na(x))/30702)*100)


#gg_miss_var(DB_projet_full[,c(1:6)])

#gg_miss_var(DB_projet_full,show_pct=TRUE)
#gg_miss_var(DB_projet_full,Gare2,show_pct = TRUE)
#print(test)
#miss_var_summary(DB_projet_full,order=FALSE,add_cumsum = TRUE)

#hist(Count_NA_VAR)


```
*Visualisation valeurs manquantes* titre à changer peut ête 

En annexe, quelques graphiques permettant de visualiser quelles variables ont le plus de valeurs manquantes. 
Ces graphiques nous permettrons d'adopter un regard critique sur les variables que nous choisirons par la suite. 
Cependant, on peut établir quelques critères avec r : ration de valeurs manquantes dans la colonne. 

Bon : r<=5% 
Moyen : 5%<r<=20% 
Mauvais 20%<r<=45% 
Très mauvais : r>45%

Plusieurs variables ont entre 80% 99% de valeurs manquantes 



## Préparation de la base de données
```{r}
library(dplyr)
#Code de test à éliminer par la suite 
set.seed(1) # Cela fige 

sample <- sample(c(TRUE,FALSE),size=nrow(DB_projet_full),replace=TRUE,prob=c(0.7,0.3))
DB_reduced <-DB_projet_full[!sample,] #base de donnée test , plus petite pour faire des opérations dessus (j'ai pris 30%)

DB_reduced<-DB_reduced%>%mutate(freqtcu=ifelse(freqtcu<=3,1,0)) #On simplifie notre variable explicative en disant que ceux qui l"utilise tous les jours (freqtcu=1) , 2 fois par semaine minimum ( freqtcu=2) et 2 fois par mois minimum ( freqtcu=3)

DB_reduced$freqtcu<-factor(DB_reduced$freqtcu) #transformation de la variable Y en facteur pour ensuite l'utiliser dans un modèle 

#str(DB_reduced[,c(67:70)])

DB_reduced<-rename(DB_reduced,"tailmng"="NO_PERS")

#DB_reduced_2<-DB_reduced[!duplicated(DB_reduced$id_pers),]  #5249 gens recencés dans le sondage mais on a besoin des infos relatives aux trajets justement donc  


#Permis 

DB_reduced<-DB_reduced%>%mutate(permis=ifelse(permis==1 | permis==3,"YES","NO")) #On dit que ceux qui passent le permis vont avoir le permis

#Car ownership 
DB_reduced$car_ownership<-c(1:nrow(DB_reduced))
DB_reduced$car_ownership<-DB_reduced%>%
  mutate(car_ownership=ifelse(DB_reduced$VP_DISPO>=1 & (DB_reduced$GENRE1==1 | DB_reduced$GENRE2==1 | DB_reduced$GENRE3==1 | DB_reduced$GENRE4==1) & (DB_reduced$POSSES1==1 | DB_reduced$POSSES2==1 | DB_reduced$POSSES3==1 | DB_reduced$POSSES4==1 ),"OUI","NON"))
                                                                              



```
**Variables du projet**

**frecqtcu** : Variable d'intérêt (Y) catégorielle qui indique la fréquence d'utilisation des transports en communs chez une personne.\newline Elle prend les valeurs  :

1 : Utilisation des transports en commun tous les jours \newline
2 : Utilisation des transports en commun au moins deux fois par semaine \newline
3 : Utilisation des transports en commun au moins deux fois par mois \newline
4: Utilisation des transports en commun très rare \newline
5 : Utilisation des transports en commun inexistante \newline
```{r} 
#code de création de la variable frecqtcu , juste reprendre ce qui a été dit en haut 
```

**tailmng** : Variable qui indique le nombre de personnes composant le ménage.
```{r}
#code création de tailmng

```
**permis**
```{r}
#Code création de permis

```
**Car ownership**

```{r}
#Création de car ownership 
```

\newpage

**Annexes**


```{r, include =FALSE}
data_2<-DB_projet_full[,c(22:30)]
vis_miss(
  data_2,
  cluster = FALSE,
  sort_miss = FALSE,
  show_perc = TRUE,
  show_perc_col = TRUE,
  large_data_size = 9e+06,
  warn_large_data = TRUE
)
```
```{r, include=TRUE}
data_2<-DB_projet_full[,c(30:44)]
vis_miss(
  data_2,
  cluster = FALSE,
  sort_miss = FALSE,
  show_perc = TRUE,
  show_perc_col = TRUE,
  large_data_size = 9e+06,
  warn_large_data = TRUE
)
```

*Listes variables à plus de 80% de valeurs manquantes*

-motoracc
-situveil
-STAT_TRAV
-TYPE_STAT4
-LIEU_STAT4
-POSSES4
-PUIS_VP4
-AN_VP4
-ENERGIE4
-GENRE4
-TYPE_STAT3
-LIEU_STAT3
-POSSES3
-PUIS_VP3
-AN_VP3
-ENERGIE3
-motdeacc
-nbarret
-abonpeage
