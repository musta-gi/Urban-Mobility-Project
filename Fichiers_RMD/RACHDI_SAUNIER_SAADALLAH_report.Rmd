---
title: '**Facteurs influençants la prise des transports en commun pour l''agglomération
  grenobloise**'
author: "RACHDI Mustapha - SAUNIER Florent - SAADALLAH Malek"
date: "Janvier 2024"
output: pdf_document
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo= FALSE, include= TRUE, warning = FALSE)

```

# Préambule

|   Ce projet se base sur des données récoltées par l'ENQUÊTE MÉNAGES DÉPLACEMENTS en 2010 dans la région Grenobloise. L'étude a pour but de déterminer les facteurs influençant la prise des transports en commun . Pour cela nous nous sommes pris comme limites : le réseau Mtag qui comprend les bus qualifiés de "ville" (Nous n'avons pas pris en compte les bus régionaux comme par exemple le bus Grenoble - Chamrousse) et le réseau du tramway dont les lignes depuis 2010 ont été augmentées.


```{r install_packages, include=FALSE}

# Liste des packages à installer et à charger
packages <- c("ggplot2", "factoextra", "FactoMineR", "cluster", "naniar", "corrplot" ,"dplyr", "rmdformats")

# Installez les packages qui ne sont pas déjà installés
new_packages <- packages[!packages %in% installed.packages()[,"Package"]]

if(length(new_packages)) install.packages(new_packages)

```


```{r load_packages, include=FALSE}
for(package in packages) {
  library(package, character.only = TRUE)
}

```


## 1. Objectif

Déterminer les facteurs influençant la prise des transports en commun pour l'agglomération grenobloise : Etudier l'impact des variables socio-économiques.

## 2. Méthodologie

## 3. Résultats


# Préparation de la base de données


## Etat de l'art

|   L'état de l'art relatif aux facteurs influençant l'utilisation des transports en commun urbains, tel que synthétisé à partir des travaux de Paulley et al. (2006), Redman et al. (2013), Zhang et al. (2022), Rasca & Saeed (2022), et Göransson & Andersson (2023), révèle une diversité de variables interdépendantes, classifiables en plusieurs catégories principales :

1. **Facteurs Économiques et Sociaux** : Les caractéristiques socio-économiques individuelles comme le revenu, la possession d'un permis de conduire, et l'accès à une voiture sont essentielles. (Paulley et al. 2006) ont notamment mis en évidence l'impact de ces facteurs sur la demande de transport en commun.

2. **Caractéristiques des Services de Transport** : Les attributs tels que les tarifs, la qualité du service, et le confort sont cruciaux (Redman et al., 2013). La perception de ces éléments peut significativement influencer les choix de mobilité.

3. **Facteurs Spatiaux** : La taille du ménage et les caractéristiques spatiales des lieux de résidence et de destination, comme la densité, influent sur l'usage des transports en commun (Zhang et al., 2022).

4. **Motivations et Perceptions** : Les motivations instrumentales, affectives, et symboliques, ainsi que les politiques publiques et les expériences émotionnelles liées à l'utilisation des transports en commun, peuvent encourager leur utilisation (Göransson & Andersson, 2023).

5. **Considérations Environnementales** : L'attrait pour des modes de transport plus durables, sous l'effet de la prise de conscience des enjeux environnementaux, peut également jouer un rôle (Rasca & Saeed, 2022).


## Overview de la base de données

```{r Overview}
load("allgre.PB_V2.RData")

DB_projet_full <- allgre.PB_V2

n_rows <- nrow(DB_projet_full)
n_cols <- ncol(DB_projet_full)

n_personnes <- nrow(table(DB_projet_full$id_pers))
n_trips <- nrow(table(DB_projet_full$id_depl))
n_mng <- nrow(table(DB_projet_full$id_men))

n_missing <- sum(is.na(DB_projet_full))

n_cols_without_na <- ncol(DB_projet_full[!apply(DB_projet_full, 2, anyNA)])

cat("Nombre d'observations :", n_rows, "\n")
cat("Nombre de variables :", n_cols, "\n")
cat("Nombre de personnes :", n_personnes, "\n")
cat("Nombre de trajets :", n_trips, "\n")
cat("Nombre de ménages :", n_mng, "\n")

cat("Nombre de valeurs manquantes :", n_missing, "\n")
cat("Proportion de valeurs manquantes :", round(n_missing/(n_rows * n_cols), 4)*100, "% \n")

cat("Proportion de variables sans valeurs manquantes :", round(n_cols_without_na/n_cols, 4)*100, "% \n")




```
En annexe, quelques graphiques permettant de visualiser quelles variables ont le plus de valeurs manquantes.

Ces graphiques nous permettrons d'adopter un regard critique sur les variables que nous choisirons par la suite. 

Cependant, on peut établir quelques critères avec r : ration de valeurs manquantes dans la colonne. 

* Bon : $r \leq  5\%$

* Moyen :$5\% < r \leq 20\%$

* Mauvais : $20\% < r \leq 45\%$

* Très mauvais : $r > 45%$

Plusieurs variables ont entre 80% et 99% de valeurs manquantes. Ceci est dû au fait que la plupart de gens n'ont tout simplement pas plus d'un véhicule, ce qui fait que les variables correspondantes sont vides. 



## Variables

### Variables de base

```{r} 
DB_projet_full$freqtcu2<-DB_projet_full$freqtcu
 DB_projet_full<-DB_projet_full%>%mutate(freqtcu=ifelse(freqtcu<=3,1,0))
DB_projet_full$freqtcu<-factor(DB_projet_full$freqtcu)

```
**Frecqtcu** : Variable d'intérêt (Y) catégorielle qui indique la fréquence d'utilisation des transports en communs chez une personne.\newline 

Elle prend les valeurs  :

**1 :** Utilisation des transports en commun **tous les jours**

**2 :** Utilisation des transports en commun **au moins deux fois par semaine**

**3 :** Utilisation des transports en commun **au moins deux fois par mois** 

**4 :** Utilisation des transports en commun **très rare**

**5 :** Utilisation des transports en commun **inexistante**

Nous avons décidé de construire *frecqtcu* de manière à ce qu'elle soit binaire. Pour toutes les personnes qui prennent les transports de manière : régulière/tous les jours , au moins deux fois par semaine et au moins deux fois par mois se sont vues attribuées la valeur 1 car le "au moins" présage une prise des transports en communs plus élevée.

**Tailmng** : Variable qui indique le nombre de personnes composant le ménage.
```{r}
DB_projet_full<-rename(DB_projet_full,"tailmng"="NO_PERS")

```
On change simplement le nom de la variable "NO_PERS" qui indique le nombre de personne dans le ménage\newline
**Permis** :Variable indiquant si la personne effectuant le trajet   possède le permis ou pas.
```{r}
DB_projet_full<-DB_projet_full%>%mutate(permis=ifelse(any(permis==1 | permis==3),"YES","NO"))
DB_projet_full$permis<-factor(DB_projet_full$permis)

```

**Car_ownership** : Variable indiquant si la personne effectuant le trajet possède une voiture pour ses déplacements

```{r}
#DB_projet_full<-DB_projet_full%>%mutate(car_ownership=ifelse(DB_projet_full$VP_DISPO>0 & (DB_projet_full$GENRE1!=2 | #DB_projet_full$GENRE2!=2 | DB_projet_full$GENRE3!=2 | DB_projet_full$GENRE4!=2) & (DB_projet_full$POSSES1==1 | #DB_projet_full$POSSES2==1 | DB_projet_full$POSSES3==1 | DB_projet_full$POSSES4==1),"OUI","NON"))

#DB_projet_full$car_ownership<-factor(DB_projet_full$car_ownership)

DB_projet_full<-DB_projet_full%>%mutate(car_ownership=ifelse(DB_projet_full$dispovp==1 | DB_projet_full$dispovp==2,"OUI","NON"))
DB_projet_full$car_ownership<-factor(DB_projet_full$car_ownership)

#table(DB_reduced$car_ownership_2)

```
Cette variable dépent de trois variables qui sont VP_dispo qui doit être strictement supérieur à 0, puis GENRE (type de véhicule utilisé) , nous avons exclu les campings cars car notre sujet se prête au milieu urbain et de POSSE (Est ce que la voiture appartient à la personne).Nous nous sommes contentés de prendre exclusivement les véhicules possedés par la personne.\newline 

### Variables complémentaires

Grâce aux variables précédentes et aux articles que l'on a trouvé dans la littérature, nous allons construire notre base de données  pour notre modèle.\newline
Nous exploiterons un ensemble de caractéristiques socio-économiques puis certaines variables liées au "confort" du trajet.


```{r}
# Variables liées au confort 
Variables_supp<-c(1,2,6,7,8,20,21,47,49,53,54,55,56,57,59,60,61,62,63,76,87,88,89,91,102,107,108,109,112,113,115,117) #c'est là qu'on va ajouter nos variables 
#str(DB_reduced[,Variables_supp])

New_DB<-cbind(DB_projet_full[,Variables_supp],DB_projet_full$freqtcu,DB_projet_full$permis,DB_projet_full$tailmng,DB_projet_full$car_ownership) #création de la nouvelles bases de données 

New_DB<-rename(New_DB,"freqtcu"="DB_projet_full$freqtcu")
New_DB<-rename(New_DB,"permis"="DB_projet_full$permis")
New_DB<-rename(New_DB,"tailmng"="DB_projet_full$tailmng")
New_DB<-rename(New_DB,"car_ownership"="DB_projet_full$car_ownership")
New_DB<-rename(New_DB,"PBM_STAT_GENERAL"="PBM_STAT")

```
Cette base de données va regrouper toutes les variables nécessaires à notre étude puis on la redivisera encore par la suite pour notamment l'utilisation de cluster 
```{r}
New_DB$TYPE_HAB<-replace(New_DB$TYPE_HAB,New_DB$TYPE_HAB==1,"INDIVIDUEL_ISO")
New_DB$TYPE_HAB<-replace(New_DB$TYPE_HAB,New_DB$TYPE_HAB==2,"INDIVIDUEL_COLE")
New_DB$TYPE_HAB<-replace(New_DB$TYPE_HAB,New_DB$TYPE_HAB==3,"PETIT_COLLECTIF")
New_DB$TYPE_HAB<-replace(New_DB$TYPE_HAB,New_DB$TYPE_HAB==4,"GRAND_COLLECTIF")
New_DB$TYPE_HAB<-replace(New_DB$TYPE_HAB,New_DB$TYPE_HAB==5,"AUTRE")
New_DB$TYPE_HAB<-factor(New_DB$TYPE_HAB)


New_DB$TYPE_OCU<-replace(New_DB$TYPE_OCU,New_DB$TYPE_OCU==1,"PROPRIETAIRE")
New_DB$TYPE_OCU<-replace(New_DB$TYPE_OCU,New_DB$TYPE_OCU==2,"LOCATAIRE_HLM")
New_DB$TYPE_OCU<-replace(New_DB$TYPE_OCU,New_DB$TYPE_OCU==3,"AUTRE_LOCATAIRE")
New_DB$TYPE_OCU<-replace(New_DB$TYPE_OCU,New_DB$TYPE_OCU==4,"LOGE_GRATUIT")
New_DB$TYPE_OCU<-replace(New_DB$TYPE_OCU,New_DB$TYPE_OCU==5,"AUTRE")
New_DB$TYPE_OCU<-factor(New_DB$TYPE_OCU)

New_DB$jourdepl<-replace(New_DB$jourdepl,New_DB$jourdepl==1,"LUNDI")
New_DB$jourdepl<-replace(New_DB$jourdepl,New_DB$jourdepl==2,"MARDI")
New_DB$jourdepl<-replace(New_DB$jourdepl,New_DB$jourdepl==3,"MERCREDI")
New_DB$jourdepl<-replace(New_DB$jourdepl,New_DB$jourdepl==4,"JEUDI")
New_DB$jourdepl<-replace(New_DB$jourdepl,New_DB$jourdepl==5,"VENDREDI")
New_DB$jourdepl<-factor(New_DB$jourdepl)






New_DB<-New_DB%>%mutate(LIEU_STAT1=ifelse(is.na(LIEU_STAT1),0,LIEU_STAT1))
New_DB$LIEU_STAT1<-replace(New_DB$LIEU_STAT1,New_DB$LIEU_STAT1==1,"GARAGE/BOX")
New_DB$LIEU_STAT1<-replace(New_DB$LIEU_STAT1,New_DB$LIEU_STAT1==2,"RUE")
New_DB$LIEU_STAT1<-replace(New_DB$LIEU_STAT1,New_DB$LIEU_STAT1==3,"PARKING PUBLIC")
New_DB$LIEU_STAT1<-replace(New_DB$LIEU_STAT1,New_DB$LIEU_STAT1==4,"PARKING PRIVÉ")
New_DB$LIEU_STAT1<-replace(New_DB$LIEU_STAT1,New_DB$LIEU_STAT1==0,"PAS_INFO") #traitement des valeurs manquantes 
New_DB$LIEU_STAT1<-factor(New_DB$LIEU_STAT1)

New_DB<-New_DB%>%mutate(TYPE_STAT1=ifelse(is.na(TYPE_STAT1),0,TYPE_STAT1))
New_DB$TYPE_STAT1<-replace(New_DB$TYPE_STAT1,New_DB$TYPE_STAT1==1,"INTERDIT")
New_DB$TYPE_STAT1<-replace(New_DB$TYPE_STAT1,New_DB$TYPE_STAT1==2,"GRATUIT")
New_DB$TYPE_STAT1<-replace(New_DB$TYPE_STAT1,New_DB$TYPE_STAT1==3,"PAYANT")
New_DB$TYPE_STAT1<-replace(New_DB$TYPE_STAT1,New_DB$TYPE_STAT1==4,"PAYÉ_TIERCE")
New_DB$TYPE_STAT1<-replace(New_DB$TYPE_STAT1,New_DB$TYPE_STAT1==0,"PAS_INFO") #traitement des valeurs manquantes on aura besoin de ça après 
New_DB$TYPE_STAT1<-factor(New_DB$TYPE_STAT1)

New_DB$sexe<-replace(New_DB$sexe,New_DB$sexe==1,"Homme")
New_DB$sexe<-replace(New_DB$sexe,New_DB$sexe==2,"Femme")
New_DB$sexe<-factor(New_DB$sexe)

New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==2,"CAP")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==3,"BEP")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==4,"BAC")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==5,"BAC+2")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==6,"BAC >= 3")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==7,"APPRENTISSAGE")
New_DB$etabscol<-replace(New_DB$etabscol,New_DB$etabscol==1,"PAS DIPLOME")
New_DB$etabscol<-factor(New_DB$etabscol)











New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 1, "TravaiPleinT")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 2, "TravailPartT")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 3, "Appreti_Stage")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 4, "Etudiant")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 7, "Retraite")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 5, "Scolaire")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 6, "RSA")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 8, "Reste_auFoyer")
New_DB$OCCU1 <- replace(New_DB$OCCU1, New_DB$OCCU1 == 9, "Autre")
New_DB$OCCU1=factor(New_DB$OCCU1)

New_DB$OCCU2 <- replace(New_DB$OCCU2, New_DB$OCCU2 == 0, "NON_Con")
New_DB$OCCU2 <- replace(New_DB$OCCU2, New_DB$OCCU2 == 1, "Travail")
New_DB$OCCU2 <- replace(New_DB$OCCU2, New_DB$OCCU2 == 2, "Etudes")
New_DB$OCCU2=factor(New_DB$OCCU2)

New_DB$csp<-replace(New_DB$csp,New_DB$csp==21 | New_DB$csp==22 | New_DB$csp==23 |New_DB$csp==31 | New_DB$csp==32 | New_DB$csp==36 | New_DB$csp==41 | New_DB$csp==46 | New_DB$csp==51 | New_DB$csp==54 | New_DB$csp==55,"HIGH_STATUT")
New_DB$csp<-replace(New_DB$csp,New_DB$csp==10 | New_DB$csp==47 | New_DB$csp==48 |New_DB$csp==56 | New_DB$csp==61| New_DB$csp==66 | New_DB$csp==69 |New_DB$csp==81 | New_DB$csp==82 | New_DB$csp==90,"LOW_STATUT")
New_DB$csp<-replace(New_DB$csp,New_DB$csp==83 | New_DB$csp==84 | New_DB$csp==85 | New_DB$csp==86 | New_DB$csp==87 | New_DB$csp==99 , "ETUDES")
New_DB$csp<-factor(New_DB$csp)

New_DB<-New_DB%>%mutate(ABO_TC=ifelse(is.na(ABO_TC),0,ABO_TC))
New_DB$ABO_TC<-replace(New_DB$ABO_TC,New_DB$ABO_TC==1,"OUI_GRATUIT")
New_DB$ABO_TC<-replace(New_DB$ABO_TC,New_DB$ABO_TC==2,"OUI_PAYANT")
New_DB$ABO_TC<-replace(New_DB$ABO_TC,New_DB$ABO_TC==3,"NON")
New_DB$ABO_TC<-replace(New_DB$ABO_TC,New_DB$ABO_TC==0,"PAS_INFO")
New_DB$ABO_TC<-factor(New_DB$ABO_TC)

New_DB<-New_DB%>%mutate(travdom=ifelse(is.na(travdom),0,travdom))
New_DB$travdom<-replace(New_DB$travdom,New_DB$travdom==1,"OUI")
New_DB$travdom<-replace(New_DB$travdom,New_DB$travdom==2,"NON")
New_DB$travdom<-replace(New_DB$travdom,New_DB$travdom==0,"PAS_INFO")
New_DB$travdom<-factor(New_DB$travdom)


New_DB<-New_DB%>%mutate(zonetrav=ifelse(is.na(zonetrav),0,zonetrav))
New_DB$zonetrav<-replace(New_DB$zonetrav,New_DB$zonetrav==0,"PAS_INFO")
#New_DB<-New_DB%>%mutate(zonetrav=case_when(zonetrav %in% c(100,114)~"CENTRE VILLE"))
New_DB$zonetrav<-replace(New_DB$zonetrav,New_DB$zonetrav %in% c(101001:114009),"CENTRE_VILLE")
New_DB$zonetrav<-replace(New_DB$zonetrav,New_DB$zonetrav %in% c(115001:143009),"AGGLO_PROCHE")
New_DB$zonetrav<-replace(New_DB$zonetrav,New_DB$zonetrav %in% c(201001:9039999),"HORS_GRENOBLE")
New_DB$zonetrav<-factor(New_DB$zonetrav)


New_DB<-New_DB%>%mutate(dispovp=ifelse(is.na(dispovp),0,dispovp))
New_DB$dispovp<-replace(New_DB$dispovp,New_DB$dispovp==1,"OUI UTILISE")
New_DB$dispovp<-replace(New_DB$dispovp,New_DB$dispovp==2,"OUI UTILISE PAS")
New_DB$dispovp<-replace(New_DB$dispovp,New_DB$dispovp==3,"NON")
New_DB$dispovp<-replace(New_DB$dispovp,New_DB$dispovp==0,"PAS INFO")
New_DB$dispovp<-factor(New_DB$dispovp)




New_DB<-New_DB%>%mutate(PBM_STAT_GENERAL=ifelse(is.na(PBM_STAT_GENERAL),0,PBM_STAT_GENERAL))
New_DB$PBM_STAT_GENERAL<-replace(New_DB$PBM_STAT_GENERAL,New_DB$PBM_STAT_GENERAL==1,"OUI")
New_DB$PBM_STAT_GENERAL<-replace(New_DB$PBM_STAT_GENERAL,New_DB$PBM_STAT_GENERAL==2,"NON PLACE RES")
New_DB$PBM_STAT_GENERAL<-replace(New_DB$PBM_STAT_GENERAL,New_DB$PBM_STAT_GENERAL==3,"NON PLACE AUTOUR")
New_DB$PBM_STAT_GENERAL<-replace(New_DB$PBM_STAT_GENERAL,New_DB$PBM_STAT_GENERAL==4,"NON HORAIRES")


New_DB$PBM_STAT_GENERAL<-replace(New_DB$PBM_STAT_GENERAL,New_DB$PBM_STAT_GENERAL==0,"PAS_INFO")
New_DB$PBM_STAT_GENERAL<-factor(New_DB$PBM_STAT_GENERAL)

New_DB<-New_DB%>%mutate(STAT_TRAV=ifelse(is.na(STAT_TRAV),0,STAT_TRAV))
New_DB$STAT_TRAV<-replace(New_DB$STAT_TRAV,New_DB$STAT_TRAV==1,"OUI")
New_DB$STAT_TRAV<-replace(New_DB$STAT_TRAV,New_DB$STAT_TRAV==2,"NON PLACE RES")
New_DB$STAT_TRAV<-replace(New_DB$STAT_TRAV,New_DB$STAT_TRAV==3,"NON PLACE AUTOUR")

New_DB$STAT_TRAV<-replace(New_DB$STAT_TRAV,New_DB$STAT_TRAV==0,"PAS_INFO")
New_DB$STAT_TRAV<-factor(New_DB$STAT_TRAV)


New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(22:29),"ETUDES")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(1:2),"DOMICILE")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(11:12),"TRAVAIL")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor==21,"CRECHE")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(31:34),"SHOOPING")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(41:43),"ADMINISTRATIF")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(51:54),"LOISIRS")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(61:74),"AMENER/RECHERCHER QLQN")
New_DB$motifor<-replace(New_DB$motifor,New_DB$motifor %in% c(81:99),"AUTRES")
New_DB$motifor<-factor(New_DB$motifor)

New_DB<-New_DB%>%mutate(prisecharge=ifelse(is.na(prisecharge),0,prisecharge))
New_DB$prisecharge<-replace(New_DB$prisecharge,New_DB$prisecharge>=1,"NON")
New_DB$prisecharge<-replace(New_DB$prisecharge,New_DB$prisecharge==3,"NON")
New_DB$prisecharge<-replace(New_DB$prisecharge,New_DB$prisecharge==0,"PAS_INFO")
New_DB$prisecharge<-factor(New_DB$prisecharge)

New_DB<-New_DB%>%mutate(NAT_STAT=ifelse(is.na(NAT_STAT),0,NAT_STAT))
New_DB$NAT_STAT<-replace(New_DB$NAT_STAT,New_DB$NAT_STAT==1,"INTERDIT")
New_DB$NAT_STAT<-replace(New_DB$NAT_STAT,New_DB$NAT_STAT==2,"GRATUIT")
New_DB$NAT_STAT<-replace(New_DB$NAT_STAT,New_DB$NAT_STAT==3,"PAYANT")
New_DB$NAT_STAT<-replace(New_DB$NAT_STAT,New_DB$NAT_STAT==4,"PAYE_TIERCE")
New_DB$NAT_STAT<-replace(New_DB$NAT_STAT,New_DB$NAT_STAT==0,"PAS_INFO")
New_DB$NAT_STAT<-factor(New_DB$NAT_STAT) # on transofmre les données qualitiatives en vecteurs ce qui permet par la suite de faire des clustering par exemple. 


```


## Restriction géographique

Définissons ce que l'on entend par "transports en communs".

Pour notre étude nous nous concentrons sur les transports en communs de la société M-Tag,c'est à dire les tram et bus du réseau.

Notre délimitation géographique sera simplement les terminaux des différentes lignes de tram/bus confondues.

Par la suite, quand on parlera de transports en communs, on se refère à la définition au dessus.  

```{r}
knitr::include_graphics("reseau tag.jpg", )
```


```{r}
Vec_zone<-c(101,102,103,104,105,106,107,108,109,110,111,112,113,114,117,118,135,119,120,136,121,122,123,124,125,126,137,138,127,128,129,130,131,132,115,140,116,134,141,142,143,302)

```


```{r}
New_DB<-dplyr::filter(New_DB,tir %in% Vec_zone) #on garde que les zones où il y a des transports en communs 
```

# Analyse

## Impact de l'occupation

Pour commencer, nous allons étudier l'impact de l'occupation sur l'utilisation des transports en commun. 

```{r}
DB_cat_soc <- New_DB[!duplicated(New_DB$id_pers),]
  
DB_cat_soc <- DB_cat_soc %>% select(id_pers, freqtcu, OCCU1) %>% na.omit() %>% dplyr::mutate(OCCU1 = as.factor(OCCU1))

```

```{r}
# Plotting
ggplot(DB_cat_soc, aes(x = OCCU1, fill = as.factor(freqtcu))) +
  geom_bar(position = "dodge", stat = "count") +
  scale_fill_manual(values = c("0" = "grey", "1" = "black")) +
  labs(x = "Occupation principale", y = "Nombre", fill = "freqtcu") +
  theme_minimal() +
  theme(legend.position = "top")
```

Nous remarquons que les étudiants utilisent majoritairement les transports en commun. 

```{r}
Etu <- DB_cat_soc %>% filter(OCCU1 == "Etudiant") %>% count(freqtcu)
Etu_use <- Etu %>% filter(freqtcu == 1) %>% select(n)


perc_Etu_use <- Etu_use/nrow(DB_cat_soc %>% filter(OCCU1 == "Etudiant") %>% na.omit())
perc_Etu_use <- as.numeric(perc_Etu_use)
cat("Proportion d'étudiants utilisant les transports en commun :", round(perc_Etu_use, 4)*100, "% \n")

```

81% des étudiants utilisent les transports en commun. Nous allons donc, nous intéresser aux non étudiants. 

## Etude des non étudiants


```{r}
#Base donnée catégorie socio prof personnes 

DB_pers_socio_1<-New_DB[,c(1,8,9,10,11,12,13,14,15,16,26,32,33,34,35,36)]
DB_pers_socio_1<-DB_pers_socio_1[!duplicated(DB_pers_socio_1$id_pers),]
DB_pers_socio_1<-dplyr::filter(DB_pers_socio_1,!is.na(DB_pers_socio_1$freqtcu))
DB_pers_socio_1<-dplyr::filter(DB_pers_socio_1,!is.na(DB_pers_socio_1$car_ownership))

DB_pers_socio_1<-dplyr::filter(DB_pers_socio_1,DB_pers_socio_1$zonetrav!="PAS_INFO")
#vis_miss(DB_pers_socio_1) # un peu freqtcu manquant 1% on peut l'enlever 

```

```{r}
#DB_cluster_2<-DB_cluster_1[sample(c(TRUE,FALSE),size=nrow(DB_cluster_1),replace=TRUE,prob=c(0.05,0.95)),]
afm_1<-FAMD(base=DB_pers_socio_1,ncp=5)

```

```{r}
#Affichage des coordonnées 5 variables latentes deux à deux orthogonales 
#head(afm_1$ind$coord,10)
```
```{r}
#Mettre les individus deux à deux si on arrive à distinguer des patterns  des formes 

#pairs(afm_1$ind$coord,cex=0.6)

#Trouver les groupes pas évident 
```
```{r}
#Classification ascendante hiérarchique 
md_1<-dist(afm_1$ind$coord)

ch_1<-hclust(md_1,method='ward.D2')

plot(ch_1)


#Le bazar mais c'est normal au vu de tous les individus , le dendograme 

#2carts de hauteur entre les paliers , ça donne une idée de la distance entre les clusters , ici deux groupes pas évident , peut être 3 groupes. Ici on tatonne pas comparé aux k-means où il faut tatonner pour trouver le bon nombre de groupe 
```
```{r}
groups_1<-cutree(ch_1,k=3)

#table(groups_1)
```
```{r}
pairs(afm_1$ind$coord,col=c('cornflowerblue','yellowgreen','red')[groups_1],cew=0.75)
```
```{r}
#sapply(DB_pers_socio_1[sapply(DB_pers_socio_1,is.numeric)],mean)
```
```{r}
#lapply(DB_pers_socio_1[sapply(DB_pers_socio_1,is.numeric)],function(x){tapply(x,groups_1,mean)})
```
```{r}
#sapply(DB_pers_socio_1[sapply(DB_pers_socio_1,is.factor)],function(x){prop.table(table(x))})
```
```{r}
#sapply(DB_pers_socio_1[sapply(DB_pers_socio_1,is.factor)],function(x){prop.table(table(groups_1,x),1)})

```



La base de données compte 1246 observations pour 15 variables, on a filtré les individus de cette base pour que les caractéristiques d'une personne apparaissent une seule fois, les variables sont toutes issues de la fiche Personne\newline
On distingue 3 groupes respectivement de 914 , 305 et 27 personnes avec le groupe 2 qui comporte pour notre variable Y freqtcu une répartition de 24% Y=0 et 76% Y=1.\newline
On remarque que pour ce groupe, 76% des gens possèdent une voiture au sens propre , 67% n'ont pas de voiture disponible pour se rendre au travail 47% se rendent travailler dans le centre ville de Grenoble contre 43% se rendant dans l'agglomération proche. 66% sont des travaileurs à plein temps et 33 % à temps partiel. 73% ont un statut social dit "élevé" avec 30% de BAC+>=3\newline
60% ont un abonnement TC payant tandis que pour le groupe 1 avec Y=0 77% et Y=1 23% , 96% des personnes n'ont pas d'abonnement aux transports en communs.\newline
Ce que l'on peut exprimer c'est une tendance à prendre les transports en communs fréquemment quand on ne dispose pas de voiture pour se rendre au travail. Avoir un abonnement gratuit aux TC n'a à priori  pas d'impact sur la prise des transports en communs. Le statut social contribue aussi bien à la prise fréquente de TC qu'à celle de la voiture\newline
Le fait de travailler en ville contribue à la prise fréquente des TC.

## Cluster avec Car_ownership 

Ici on va restreindre notre base de données avec les déplacements des personnes et l'influence des variables dites de confort reliées à la voiture , car_ownership n'est plus simplement le fait de posséder une voiture c'est plus global que cela   

```{r}
#c(6,7,8,9,17,18,19,20,21,23,24,28,31)
DB_car_ownership<-New_DB[,c(8,9,18,26,33,34,36)]
DB_car_ownership<-DB_car_ownership[!duplicated(DB_car_ownership$id_pers),]
#DB_car_ownership<-dplyr::filter(DB_car_ownership,!is.na(DB_car_ownership$id_depl))
#DB_car_ownership<-dplyr::filter(DB_car_ownership,!is.na(DB_car_ownership$duree))
DB_car_ownership<-dplyr::filter(DB_car_ownership,!is.na(DB_car_ownership$car_ownership))
DB_car_ownership<-dplyr::filter(DB_car_ownership,!is.na(DB_car_ownership$freqtcu))

#DB_car_ownership<-dplyr::filter(DB_car_ownership,DB_car_ownership$PBM_STAT_GENERAL!="PAS_INFO")
#DB_car_ownership<-dplyr::filter(DB_car_ownership,DB_car_ownership$STAT_TRAV!="PAS_INFO")

#vis_miss(DB_car_ownership)
```
```{r}
#table(DB_car_ownership$car_ownership)
```

```{r}
afm_3<-FAMD(DB_car_ownership, ncp=5)
#summary(afm_3)
```
```{r}
#head(afm_3$ind$coord)
```
```{r}
pairs(afm_3$ind$coord,cex=0.5) 
```
```{r}
md_3<-dist(afm_3$ind$coord)
ch_3<-hclust(md_3,method="ward.D2")

plot(ch_3)
```
```{r}
groups_3<-cutree(ch_3,k=3)
#table(groups_3)
```
```{r}
pairs(afm_3$ind$coord,col=c('cornflowerblue','yellowgreen','red')[groups_3],cew=0.75)
```
```{r}
#lapply(DB_car_ownership[sapply(DB_car_ownership,is.numeric)],function(x){tapply(x,groups_3,sd)})
#lapply(DB_car_ownership[sapply(DB_car_ownership,is.numeric)],function(x){tapply(x,groups_3,mean)})
#lapply(DB_car_ownership[sapply(DB_car_ownership,is.numeric)],function(x){tapply(x,groups_3,var)})


```

```{r}
#sapply(DB_car_ownership[sapply(DB_car_ownership,is.factor)],function(x){prop.table(table(groups_3,x),1)})

```
Le confort lié à la voiture se traduit par une place de parking disponible ou non une fois arrivé sur son lieu de travail ou d'études,il semblerait que le fait d'avoir une place de parking sur son lieu de travail encourage les gens a prendre leur voiture plutôt que les transports en communs. 66% des personnes du groupe 2 (75% des personnes n'ont pas une utilisation régulière des transports en communs) n'auraient pas de problèmes de stationnement au travail. 
De plus, le simple fait d'avoir une voiture n'a pas un rôle significatif dans l'utilisation ou non des transports en communs.
Il est important de noter qu'il y a beaucoup de valeurs manquantes en ce qui concerne les variables PBM STAT et STAT TRAV 

## Cluster avec les trajets


```{r}
DB_trip<-New_DB[,c(20,21,22,23,26,27,28,29,30,31,33,36)]
DB_trip<-dplyr::filter(DB_trip,!is.na(DB_trip$id_traj))
DB_trip<-dplyr::filter(DB_trip,!is.na(DB_trip$ntraj))
DB_trip<-dplyr::filter(DB_trip,!is.na(DB_trip$Couteff))
DB_trip<-dplyr::filter(DB_trip,!is.na(DB_trip$car_ownership))
#DB_trip<-dplyr::filter(DB_trip,!is.na(DB_trip$D13))



#vis_miss(DB_trip)

```
```{r}
DB_trip_2<-DB_trip[,-c(5,6,9)]
```

```{r}
afm_4<-FAMD(DB_trip, ncp=5)
#summary(afm_4)
```
```{r}
#head(afm_4$ind$coord)
```
```{r}
pairs(afm_4$ind$coord,cex=0.5)
```

```{r}
md_4<-dist(afm_4$ind$coord)
ch_4<-hclust(md_4,method="ward.D2")

plot(ch_4)
```
```{r}
groups_4<-cutree(ch_4,k=3)
#table(groups_4)
```
```{r}
pairs(afm_4$ind$coord,col=c('cornflowerblue','yellowgreen')[groups_4],cew=0.75)

```
```{r}
#lapply(DB_trip[sapply(DB_trip,is.numeric)],function(x){tapply(x,groups_4,sd)})
#lapply(DB_trip[sapply(DB_trip,is.numeric)],function(x){tapply(x,groups_4,mean)})
#lapply(DB_trip[sapply(DB_trip,is.numeric)],function(x){tapply(x,groups_4,median)})

#lapply(DB_trip[sapply(DB_trip,is.numeric)],function(x){tapply(x,groups_4,var)})
```
```{r}
#sapply(DB_trip[sapply(DB_trip,is.factor)],function(x){prop.table(table(groups_4,x),1)})

```

Notre clustering mix s'est porté sur un échantillon après filtrage de 4043 trajets, deux groupes ont pu être mis en évidence, dans le premier groupe (3599 trajets) 72% des trajets ont été faits par des personnes n'utilisant pas fréquemment les transports en communs et dans le deuxième group (444 trajets) 76% des trajets ont été faits par des personnes utilisant fréquemment les transports en communs.

En moyenne les temps de trajets sont plus longs avec l'utilisation des transports en communs ( btt_mean c'est à dire le temps passé dans un trajet quotidiennement qui vaut 268 minutes, dans le deuxième groupe contre 96 minutes dans le premier) ou bien duree qui est en moyene de 57 minutes contre 17 minutes dans le premier groupe.Il faudrait néanmmoins voir ce que nous disent le groupe travaillant sur les heures de pointes car il y a peut être un rapport différent durant ces horraires là.

Le motif de déplacement est assez similaire lorsqu'il s'agit de se rendre au travail, il n'y a pas de différence notoire, cependant, lorsqu'il s'agit de déposer une personne , l'usage des transports en communs n'est pas privilégié.

Toujours en lien avec notre variable (W) car_ownership, le fait d'avoir à disposition un véhicule favorise grandement son utilisation au détriment des TC , les trajets du premier groupe sont effectués avec 90% des personnes qui ont à disposition un véhicule contre 1 personne sur deux pour le deuxième groupe.







# Modèles de prédiction

# conclusion

# Annexes

## Bibliographie


|   # | Authors                                                                                           |   Year | Title                                                                                                                    | Source                                            |
|----:|:--------------------------------------------------------------------------------------------------|-------:|:-------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------|
|   1 | Paulley, N., Balcombe, R., Mackett, R., Titheridge, H., Preston, J., Wardman, M., ... & White, P. |   2006 | The demand for public transport: The effects of fares, quality of service, income and car ownership.                     | Transport policy, 13(4), 295-306.                 |
|   2 | Redman, L., Friman, M., Gärling, T., & Hartig, T.                                                 |   2013 | Quality attributes of public transport that attract car users: A research review.                                        | Transport policy, 25, 119-127.                    |
|   3 | Zhang, Wang, M., Dong, J., Lu, W., Liu, Y., Ni, A., & Yu, X.                                      |   2022 | Factors and Mechanism Affecting the Attractiveness of Public Transport: Macroscopic and Microscopic Perspectives.        | Journal of Advanced Transportation, 2022, 1–16.   |
|   4 | Raşca, & Saeed, N.                                                                                |   2022 | Exploring the factors influencing the use of public transport by commuters living in networks of small cities and towns. | Travel, Behaviour & Society, 28, 249–263.         |
|   5 | Göransson, & Andersson, H.                                                                        |   2023 | Factors that make public transport systems attractive: a review of travel preferences and travel mode choices.           | European Transport Research Review, 15(1), 32–14. |

